# ================================
# Email Service Configuration
# ================================

# Email Provider Selection
# Options: 'sendgrid', 'ses', 'smtp', 'stub'
# - sendgrid: SendGrid API (recommended for MVP)
# - ses: AWS Simple Email Service (recommended for production scale)
# - smtp: Standard SMTP (development/testing)
# - stub: Development mode (logs emails, doesn't send)
EMAIL_SERVICE=stub

# Email Sender Configuration
EMAIL_FROM=DeepRef <noreply@deepref.ai>
EMAIL_REPLY_TO=support@deepref.ai

# Feature Flags
EMAIL_ENABLE_QUEUE=true              # Use Bull queue for async processing
EMAIL_ENABLE_TRACKING=true           # Track email delivery, opens, clicks
EMAIL_PREVIEW_MODE=false             # Save emails as HTML files instead of sending
EMAIL_CAPTURE_DIR=./email-previews   # Directory for email previews

# Development/Testing
EMAIL_TEST_RECIPIENT=                # Override all recipients in dev mode

# Rate Limiting
EMAIL_RATE_LIMIT_USER_HOURLY=10      # Max emails per user per hour
EMAIL_RATE_LIMIT_USER_DAILY=50       # Max emails per user per day
EMAIL_RATE_LIMIT_GLOBAL_HOURLY=1000  # Max total emails per hour

# ================================
# SendGrid Configuration
# ================================
# Get API key from: https://app.sendgrid.com/settings/api_keys
SENDGRID_API_KEY=SG.your_api_key_here
SENDGRID_WEBHOOK_SECRET=your_webhook_secret

# ================================
# AWS SES Configuration
# ================================
# AWS credentials (create IAM user with SES permissions)
AWS_SES_REGION=us-east-1
AWS_SES_ACCESS_KEY_ID=your_access_key_id
AWS_SES_SECRET_ACCESS_KEY=your_secret_access_key

# SES Configuration Set (for tracking)
AWS_SES_CONFIGURATION_SET=deepref-emails

# ================================
# SMTP Configuration
# ================================
# Gmail example (use App Password, not regular password)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_SECURE=false                    # true for 465, false for 587
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=your-app-password

# Other SMTP providers:
# - Mailgun: smtp.mailgun.org (port 587)
# - Mailtrap: smtp.mailtrap.io (port 2525)
# - Office 365: smtp.office365.com (port 587)

# ================================
# Email Queue Configuration
# ================================
EMAIL_QUEUE_NAME=email-sending
EMAIL_QUEUE_ATTEMPTS=3                # Number of retry attempts
EMAIL_QUEUE_BACKOFF_DELAY=5000       # Initial backoff delay (ms)
EMAIL_QUEUE_BACKOFF_TYPE=exponential # 'fixed' or 'exponential'

# ================================
# Template Configuration
# ================================
EMAIL_TEMPLATE_DIR=./src/email/templates
EMAIL_BASE_URL=https://deepref.ai
EMAIL_LOGO_URL=https://deepref.ai/logo.png
EMAIL_SUPPORT_URL=https://deepref.ai/support
EMAIL_UNSUBSCRIBE_URL=https://deepref.ai/unsubscribe

# ================================
# Compliance Configuration
# ================================
EMAIL_COMPANY_NAME=DeepRef
EMAIL_COMPANY_ADDRESS=123 Main Street, City, State 12345, USA
EMAIL_PRIVACY_URL=https://deepref.ai/privacy
EMAIL_TERMS_URL=https://deepref.ai/terms

# ================================
# Redis Configuration (for queue)
# ================================
# Note: Email queue uses the same Redis instance as cache
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# ================================
# Monitoring & Analytics
# ================================
# Email statistics and delivery tracking
EMAIL_RETENTION_DAYS=90              # Days to keep email logs

# ================================
# Provider-Specific Notes
# ================================

# SendGrid Setup:
# 1. Create account at sendgrid.com
# 2. Verify your domain (DNS records: SPF, DKIM, DMARC)
# 3. Create API key with "Mail Send" permission
# 4. Set up Event Webhook: https://your-domain.com/api/v1/email/webhook/sendgrid
# 5. Enable tracking: Opens, Clicks, Bounces, Spam Reports

# AWS SES Setup:
# 1. Request production access (exit sandbox mode)
# 2. Verify your domain in SES console
# 3. Create IAM user with SES permissions
# 4. Set up SNS topic for bounce/complaint notifications
# 5. Configure webhook: https://your-domain.com/api/v1/email/webhook/ses
# 6. Create Configuration Set for tracking

# SMTP Setup (Gmail):
# 1. Enable 2-factor authentication on your Google account
# 2. Generate App Password: https://myaccount.google.com/apppasswords
# 3. Use the 16-character app password (not your regular password)
# 4. Gmail limit: 500 emails/day for free accounts

# Testing Services:
# - Ethereal: https://ethereal.email (fake SMTP for testing)
# - Mailtrap: https://mailtrap.io (email sandbox)
# - MailHog: https://github.com/mailhog/MailHog (local email testing)
